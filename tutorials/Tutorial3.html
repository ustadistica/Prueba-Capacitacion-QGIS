<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Análisis de la tabla de atributos en Python</title>
  <link rel="stylesheet" href="../css/styles.css"/>
  <style>
    /* Estilos mínimos para bloques de código */
    pre {
      background: #0f172a; color: #e2e8f0;
      padding: 1rem; border-radius: 8px; overflow: auto;
      font-size: .95rem; line-height: 1.45;
    }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
    .img-center { text-align:center; margin: 1rem 0; }
    .img-center img { max-width: 92%; height: auto; border-radius: 6px; box-shadow: 0 4px 12px rgba(0,0,0,.08); }
    .note { background:#fffbea; border:1px solid #ffe58f; padding:.9rem 1rem; border-radius:8px; margin:1rem 0; }
  </style>
</head>
<body>
  <header>
    <h1>Análisis de la tabla de atributos en Python</h1>
    <p>Consultora de la Facultad de Estadística - Universidad Santo Tomás</p>
  </header>

  <nav>
    <a href="index.html">Inicio</a>
    <a href="tutorials/../Introducción.html">Introducción Web</a>
    <a href="tutorials/../Tutorial2.html">Ahora con Raster</a>
    <a href="tutorials/../recursos.html">Recursos</a>
  </nav>

  <div class="container">

    <h2>Introducción</h2>
    <p>
      En este módulo conectamos QGIS con Python para analizar la <strong>tabla de atributos</strong> exportada desde QGIS,
      unirla con las <strong>geometrías</strong> y con una capa de <strong>puntos</strong>, y producir mapas y salidas listas para volver a QGIS.
      Verás un flujo completo y reproducible: <em>leer datos → limpiar/estandarizar → unir → visualizar → exportar</em>.
    </p>

    <div class="note">
      <strong>Requisitos:</strong> <code>pandas</code>, <code>geopandas</code>, <code>matplotlib</code>, <code>pyproj</code>, <code>shapely</code>.
      (Opcional: <code>contextily</code>, <code>folium</code> para teselas e interacción).
    </div>

    <h2>Paso 0 — Preparación del entorno</h2>
    <pre><code class="language-bash"># Instalar (si hace falta)
pip install pandas geopandas matplotlib pyproj shapely
# opcional
pip install contextily folium
</code></pre>

    <h2>Paso 1 — Leer la tabla de atributos (Excel/CSV)</h2>
    <p>Si exportaste la tabla desde QGIS en <strong>Excel</strong> (o CSV), cárgala con Pandas:</p>
    <pre><code class="language-python">import pandas as pd

df = pd.read_excel("/content/tabla de atributos de menores (1).xlsx")  # ajusta ruta/nombre
# Si fuera CSV:
# df = pd.read_csv("data/tabla_atributos.csv", encoding="utf-8")

df.head()</code></pre>

<div class="img-center">
  <img src="../img/copy image 49.jpeg" alt="Vista inicial de la tabla de atributos en Python">
</div>
    
    <div class="img-center">
      <!-- Reemplaza el src por el nombre real de tu imagen #1 -->
      <img src="../img/p4_01_df_head.png" alt="Vista inicial de df.head() (tabla de atributos desde Excel)">
    </div>

    <h2>Paso 2 — Cargar geometrías (polígonos) desde ZIP</h2>
    <p>Lee las geometrías (polígonos de localidades) comprimidas en ZIP directamente con GeoPandas:</p>
    <pre><code class="language-python">import geopandas as gpd

geo_df = gpd.read_file("/content/poligonos-localidades.zip")  # .shp dentro del .zip
display(geo_df.head())
geo_df.crs  # verifica el CRS de origen
</code></pre>

 <div class="img-center">
  <img src="../img/copy image 50.jpeg" alt="Geometrías de localidades cargadas desde archivo ZIP">
</div>
    
    <div class="img-center">
      <img src="../img/p4_02_geo_df_head.png" alt="Polígonos: geo_df.head() cargado desde ZIP">
    </div>

    <div class="note">
      <strong>CRS recomendado Bogotá:</strong> EPSG:3116. Si el shapefile está en otro CRS, reproyecta:
      <pre><code class="language-python">geo_df = geo_df.to_crs(3116)</code></pre>
    </div>

    <h2>Paso 3 — Limpiar claves y hacer <em>merge</em></h2>
    <p>Asegúrate de que los campos usados para unir (por ejemplo <code>LocNombre</code> en df y <code>Nombre_de_l</code> en geo_df) estén normalizados (trim, mayúsculas, etc.).</p>
    <pre><code class="language-python"># Estandarizar nombres antes de unir
df["LocNombre"]      = df["LocNombre"].str.strip()
geo_df["Nombre_de_l"] = geo_df["Nombre_de_l"].str.strip()

# Unir atributos (df) con geometrías (geo_df)
merged_df = df.merge(geo_df, left_on="LocNombre", right_on="Nombre_de_l")

# Convertir a GeoDataFrame conservando la columna geometry de geo_df
gdf = gpd.GeoDataFrame(merged_df, geometry="geometry")
gdf.head()</code></pre>

<div class="img-center">
  <img src="../img/copy image 51.jpeg" alt="DataFrame unido con geometría (gdf.head())">
</div>
    
    <div class="img-center">
      <img src="../img/p4_03_merge_gdf_head.png" alt="DataFrame unido con geometría (gdf.head())">
    </div>

    <h2>Paso 4 — Mapa de áreas por localidad (polígonos)</h2>
    <p>Dibuja un mapa simple por localidad. Los colores se asignan automáticamente; puedes ajustar el esquema según tu variable (categoría/valor).</p>
    <pre><code class="language-python">import matplotlib.pyplot as plt

ax = gdf.plot(column="LocNombre", legend=True, figsize=(7,9), edgecolor="#444", linewidth=.4)
ax.set_title("Mapa de Áreas Geográficas con Colores", loc="left")
ax.set_axis_off()
plt.show()</code></pre>

<div class="img-center">
  <img src="../img/copy image 52.jpeg" alt="Mapa de áreas geográficas con colores">
</div>
    
    <div class="img-center">
      <img src="../img/p4_04_mapa_poligonos.png" alt="Mapa de áreas por localidad (polígonos)">
    </div>

    <h2>Paso 5 — Cargar puntos (consultorios) desde ZIP</h2>
    <p>Lee la capa de <strong>puntos</strong> (por ejemplo, consultorios) comprimida en ZIP:</p>
    <pre><code class="language-python">points_gdf = gpd.read_file("/content/cons.zip")
display(points_gdf.head())

# Alinea CRS de puntos con el de gdf para graficar juntos
if points_gdf.crs != gdf.crs:
    points_gdf = points_gdf.to_crs(gdf.crs)</code></pre>

<div class="img-center">
  <img src="../img/copy image 53.jpeg" alt="Datos de puntos cargados desde cons.zip">
</div>

    <div class="img-center">
      <img src="../img/p4_05_points_head.png" alt="Vista inicial de points_gdf.head()">
    </div>

    <h2>Paso 6 — Mapa de polígonos + puntos</h2>
    <p>Superpone los puntos sobre las áreas para una vista conjunta.</p>
    <pre><code class="language-python">fig, ax = plt.subplots(figsize=(7,9))

# Capa base: polígonos
gdf.plot(ax=ax, color="#cfd8dc", edgecolor="#444", linewidth=.4)

# Capa de polígonos por categoría (solo para leyenda de localidades)
gdf.plot(column="LocNombre", ax=ax, legend=True, edgecolor="#444", linewidth=.2, alpha=0.7)

# Capa de puntos
points_gdf.plot(ax=ax, markersize=5, color="#e53935", alpha=0.8)

ax.set_title("Mapa de Áreas Geográficas con Puntos", loc="left")
ax.set_axis_off()
plt.show()</code></pre>

<div class="img-center">
  <img src="../img/copy image 54.jpeg" alt="Mapa de áreas geográficas con puntos superpuestos">
</div>
    
    <div class="img-center">
      <img src="../img/p4_06_mapa_puntos.png" alt="Mapa de áreas con puntos superpuestos">
    </div>

    <h2>Paso 7 — Guardar resultados (volver a QGIS)</h2>
    <p>Exporta las salidas con geometría para usarlas en QGIS (recomendado GeoPackage):</p>
    <pre><code class="language-python"># GeoPackage (GPKG)
gdf.to_file("salidas/localidades_atributos.gpkg", driver="GPKG")
points_gdf.to_file("salidas/consultorios.gpkg", driver="GPKG")

# GeoJSON (alternativo)
gdf.to_file("salidas/localidades_atributos.geojson", driver="GeoJSON")
points_gdf.to_file("salidas/consultorios.geojson", driver="GeoJSON")</code></pre>

    <h2>Conclusión</h2>
    <p>
      Integraste la tabla de atributos con las geometrías y una capa de puntos, obtuviste mapas y salidas listas para
      volver a QGIS. Este flujo te permite reproducir los análisis, auditar transformaciones y ampliar el
      alcance con librerías de Python (EDA, modelado, automatización).
    </p>

  </div>

  <footer>
    Desarrollado por la Consultora de la Facultad de Estadística - Universidad Santo Tomás © 2025
  </footer>
</body>
</html>


